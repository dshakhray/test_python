From 3df367af0051b20da5968efdcc31bfe068e19005 Mon Sep 17 00:00:00 2001
From: Vitaly Kuznetsov <vkuznets@redhat.com>
Date: Tue, 24 May 2016 13:00:04 +0200
Subject: [hv] balloon: reset host_specified_ha_region

Message-id: <1464094804-10721-5-git-send-email-vkuznets@redhat.com>
Patchwork-id: 147361
O-Subject: [RHEL7.3 KERNEL PATCH 4/4] Drivers: hv: balloon: reset host_specified_ha_region
Bugzilla: 1325967
Z-Bugzilla: 1372339
RH-Acked-by: Cathy Avery <cavery@redhat.com>
RH-Acked-by: Jeremy McNicoll <jmcnicol@redhat.com>

Upstream commit d19a55d6ed5bf0ffe553df2d8bf91d054ddf2d76
Author: Vitaly Kuznetsov <vkuznets@redhat.com>
Date:   Sat Apr 30 19:21:36 2016 -0700

    Drivers: hv: balloon: reset host_specified_ha_region

    We set host_specified_ha_region = true on certain request but this is a
    global state which stays 'true' forever. We need to reset it when we
    receive a request where ha_region is not specified. I did not see any
    real issues, the bug was found by code inspection.

    Signed-off-by: Vitaly Kuznetsov <vkuznets@redhat.com>
    Signed-off-by: K. Y. Srinivasan <kys@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

Signed-off-by: Vitaly Kuznetsov <vkuznets@redhat.com>
Signed-off-by: Alexander Gordeev <agordeev@redhat.com>

diff --git a/drivers/hv/hv_balloon.c b/drivers/hv/hv_balloon.c
index f80a281..16d01cb 100644
--- a/drivers/hv/hv_balloon.c
+++ b/drivers/hv/hv_balloon.c
@@ -1386,6 +1386,7 @@ static void balloon_onchannelcallback(void *context)
      * This is a normal hot-add request specifying
      * hot-add memory.
      */
+    dm->host_specified_ha_region = false;
     ha_pg_range = &ha_msg->range;
     dm->ha_wrk.ha_page_range = *ha_pg_range;
     dm->ha_wrk.ha_region_range.page_range = 0;
-- 
1.7.1
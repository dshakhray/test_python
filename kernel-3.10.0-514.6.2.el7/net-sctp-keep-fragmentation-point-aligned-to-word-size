From 94744fe9a23f605084edd17de070d858ed32691b Mon Sep 17 00:00:00 2001
From: Hangbin Liu <haliu@redhat.com>
Date: Fri, 2 Dec 2016 04:07:03 -0500
Subject: [net] sctp: keep fragmentation point aligned to word size

Message-id: <1480651625-25420-2-git-send-email-haliu@redhat.com>
Patchwork-id: 160959
O-Subject: [RHEL7.4 net PATCH 1/3] sctp: keep fragmentation point aligned to word size
Bugzilla: 1399459
Z-Bugzilla: 1399458
CVE: CVE-2016-9555
RH-Acked-by: Xin Long <lxin@redhat.com>
RH-Acked-by: Sabrina Dubroca <sdubroca@redhat.com>
RH-Acked-by: Marcelo Leitner <mleitner@redhat.com>
RH-Acked-by: Davide Caratti <dcaratti@redhat.com>

Bugzilla: https://bugzilla.redhat.com/show_bug.cgi?id=1399459
Brew: https://brewweb.devel.redhat.com/taskinfo?taskID=12187771
Upstream Status: net.git commit 659e0bcaebc

commit 659e0bcaebc4ca36e64eac6e9f39c1904b17472c
Author: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>
Date:   Sat Mar 19 12:17:43 2016 -0300

    sctp: keep fragmentation point aligned to word size

    If the user supply a different fragmentation point or if there is a
    network header that cause it to not be aligned, force it to be aligned.

    Fragmentation point at a value that is not aligned is not optimal.  It
    causes extra padding to be used and has just no pros.

    v2:
     - Make use of the new WORD_TRUNC macro

    Signed-off-by: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

Signed-off-by: Hangbin Liu <haliu@redhat.com>
Signed-off-by: Frantisek Hrbata <fhrbata@hrbata.com>

diff --git a/include/net/sctp/sctp.h b/include/net/sctp/sctp.h
index 24e7e33..cd487fb 100644
--- a/include/net/sctp/sctp.h
+++ b/include/net/sctp/sctp.h
@@ -439,7 +439,7 @@ static inline int sctp_frag_point(const struct sctp_association *asoc, int pmtu)
  if (asoc->user_frag)
   frag = min_t(int, frag, asoc->user_frag);
 
- frag = min_t(int, frag, SCTP_MAX_CHUNK_LEN);
+ frag = WORD_TRUNC(min_t(int, frag, SCTP_MAX_CHUNK_LEN));
 
  return frag;
 }
-- 
1.7.1